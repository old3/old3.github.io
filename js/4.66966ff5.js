(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"6YS0":function(t,a,e){"use strict";var s=e("kHkJ"),r=e.n(s);r.a},"7qb8":function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("q-page",{attrs:{padding:""}},[s("div",{staticClass:"relative-position"},[s("q-card",{staticClass:"relative-position"},[s("q-card-title",[t._v("\n        概况\n        "),s("q-btn",{staticClass:"q-ml-md float-right text-green",attrs:{dense:"",round:"",icon:"fas fa-sync-alt",size:"sm"},on:{click:t.getMeta}}),s("q-btn",{staticClass:"q-ml-md float-right text-orange",attrs:{dense:"",round:"",size:"sm",icon:"fas fa-question"},on:{click:function(a){t.helpInfo=!0}}})],1),s("q-card-separator"),s("q-card-main",{staticClass:"row"},[s("div",{staticClass:"column q-mr-md"},[s("span",{staticClass:"q-mr-sm"},[t._v("当前牌数："),s("strong",[t._v(t._s((t.meta.queue||[]).length))]),t._v(" 张")]),s("span",{staticClass:"q-mr-sm"},[t._v("牌池金额："),s("strong",[t._v(t._s(t.meta.currentBets/Math.pow(10,18)))]),t._v(" NAS")])]),s("div",{staticClass:"column "},[s("span",{staticClass:"q-mr-sm"},[t._v("最低出价："),s("strong",[t._v(t._s(t.meta.minUnit))]),t._v(" NAS")]),s("span",{staticClass:"q-mr-sm"},[t._v("最高出价："),s("strong",[t._v(t._s(t.meta.maxUnit))]),t._v(" NAS")])])])],1),s("q-card",{staticClass:"q-mt-md relative-position"},[s("q-card-title",[t._v("\n        牌池\n        "),s("q-btn",{staticClass:"q-ml-md float-right text-green",attrs:{dense:"",round:"",icon:"fas fa-plus",size:"sm"},on:{click:t.newCard}})],1),s("q-card-separator"),s("q-card-main",[s("div",{staticClass:"q-my-md row "},[0==(t.meta.queue||[]).length?s("div",{staticClass:"q-ma-sm q-pa-sm shadow-4 card"},[s("img",{attrs:{src:e("xXl9"),width:"80px"}})]):t._e(),t._l(t.cards,function(a,e){return s("div",{staticClass:"column q-ma-sm q-pa-sm shadow-4 relative-position card",style:{background:a.playerAddress==t.address?"lightblue":""},on:{click:function(a){t.openCardInfo(e)}}},[s("div",{staticClass:"absolute shadow-1 bg-yellow",staticStyle:{top:"-10px",left:"-10px"}},[t._v("\n              #"+t._s(e+1)+"\n            ")]),s("img",{attrs:{src:"../statics/cards/PNG/"+a.png+".png",width:"80px"}}),s("div",{staticClass:"cardFoot q-pt-sm row justify-center "},[s("span",{staticClass:"text-weight-bolder q-mx-sm "},[t._v(t._s(a.betNAS/Math.pow(10,18))+" ")]),s("span",{staticClass:"text-faded "},[t._v("NAS")])])])}),s("div",{staticClass:"column justify-center q-py-xl q-ma-sm q-pa-sm"},[s("q-btn",{staticStyle:{width:"80px"},attrs:{color:"green"},on:{click:t.newCard}},[t._v("出牌")])],1)],2)])],1),s("q-table",{staticClass:"q-mt-md q-pb-sm",attrs:{title:"收割记录",data:t.tableData,columns:t.columns,"hide-bottom":""}}),s("div",{staticClass:"q-caption float-right text-faded"},[t._v("*仅显示最近10条")]),s("q-inner-loading",{attrs:{visible:t.loading}},[s("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1)],1),s("q-modal",{staticClass:"relative-position",style:{background:t.win?"yellow":""},attrs:{minimized:"","content-css":{padding:"20px"}},model:{value:t.returned,callback:function(a){t.returned=a},expression:"returned"}},[t.win?s("div",{staticClass:"q-display-1 q-mb-md "},[t._v("收割成功")]):s("div",{staticClass:"q-display-1 q-mb-md"},[t._v("出牌成功")]),s("div",{staticClass:"column justify-center",staticStyle:{"align-items":"center"}},[s("img",{attrs:{src:"../statics/cards/png/"+(t.returnedCard.png||"default")+".png",width:"80px"}}),s("div",{staticClass:"q-mt-md"},[t._v("收割 "+t._s(t.trade_cardsNum||0)+" 张牌，赚取 "+t._s(t.trade_nas||0)+" NAS")]),t.win?s("div",{staticClass:"absolute shadow-1 bg-yellow text-green",staticStyle:{top:"0px",right:"0px"}},[t._v("\n        收割\n      ")]):t._e()])]),s("q-modal",{staticClass:"relative-position",attrs:{minimized:"","content-css":{padding:"20px"}},model:{value:t.cardInfo,callback:function(a){t.cardInfo=a},expression:"cardInfo"}},[s("div",{staticClass:"q-display-1 q-mb-md"},[t._v("卡牌信息")]),s("p",[t._v("玩家："+t._s(t.curCard.shortAddr))]),s("p",[t._v("出价："+t._s(t.curCard.betNAS/Math.pow(10,18))+"   NAS")]),s("p",[t._v("时间："+t._s(t.curCard.dateStr))]),s("q-btn",{staticClass:"float-right",attrs:{color:"orange",label:"关闭"},on:{click:function(a){t.cardInfo=!1}}}),s("div",{staticClass:"absolute shadow-1 ",staticStyle:{top:"0px",right:"0px"}},[s("img",{attrs:{src:"../statics/cards/png/"+(t.curCard.png||"default")+".png",width:"50px"}})])],1),s("q-modal",{attrs:{minimized:"","content-css":{padding:"20px"}},model:{value:t.helpInfo,callback:function(a){t.helpInfo=a},expression:"helpInfo"}},[s("div",{staticClass:"q-display-1 q-mb-md"},[t._v("开火车指南")]),s("p",[t._v("1. 每个人都可以请求出一张牌，系统会随机给你一张牌，放在队列的末尾")]),s("p",[t._v("2. 出牌的同时需要投注，金额不低于前一张牌的投注金额")]),s("p",[t._v("3. 如果你出的牌跟队列之前的某张牌"),s("strong",[t._v("数字")]),t._v("一样，那么这两张牌中间的所有牌所附带的投注NAS都归你！")]),s("p",{staticClass:"text-red q-caption"},[t._v("*注意，您需要安装NAS钱包插件或手机NAS钱包")]),s("div",[s("q-btn",{staticClass:"q-my-md float-right",attrs:{color:"primary",label:"明白"},on:{click:t.readHelp}})],1)]),s("q-modal",{attrs:{minimized:"","content-css":{padding:"20px"}},model:{value:t.newCardDialog,callback:function(a){t.newCardDialog=a},expression:"newCardDialog"}},[s("div",{staticClass:"q-display-1 q-mb-md"},[t._v("出牌\n      "),s("span",{staticClass:"q-body-2"},[t._v("目前"),s("strong",[t._v(t._s(t.meta.currentLength||0))]),t._v("张牌  共\n   "),s("strong",[t._v(" "+t._s((t.meta.currentBets||0)/Math.pow(10,18)))]),t._v("NAS")])]),s("q-field",{attrs:{label:"押注金额",orientation:"vertical",helper:"不得低于"+t.lastValue+" NAS(上一张牌金额)"}},[s("q-input",{attrs:{color:"orange",type:"number",suffix:"NAS"},model:{value:t.newCard_amount,callback:function(a){t.newCard_amount=a},expression:"newCard_amount"}})],1),s("div",{staticClass:"q-mt-xl float-right"},[s("q-btn-group",{attrs:{push:""}},[s("q-btn",{attrs:{color:"orange",glossy:"",push:"",label:"关闭"},on:{click:function(a){t.newCardDialog=!1}}}),s("q-btn",{attrs:{color:"primary",glossy:"",push:"",label:"确认"},on:{click:t.getACard}})],1)],1)],1)],1)},r=[];s._withStripped=!0;e("a1Th"),e("9VmF"),e("SRfc");var n={data:function(){return{cardInfo:!1,isMobile:!0,isDesktop:!1,isIOS:!1,isAndroid:!0,newCardDialog:!1,newCard_amount:0,loading:!1,loading_cards:!1,loading_meta:!1,loading_trades:!1,meta:{},network:"mainNet",card_interval:-1,curCard:{},cards:[],lastValue:.01,nebPay_mainnetUrl:"https://pay.nebulas.io/api/mainnet/pay",nebPay_testnetUrl:"https://pay.nebulas.io/api/pay",returned:!1,returnedCard:{},returnedTrade:{},win:!1,columns:[{name:"date",label:"日期",field:"date"},{name:"winner",label:"玩家",field:"winner"},{name:"cardsNum",label:"牌数",field:"cardsNum"},{name:"nas",label:"金额",field:"nas"}],trade_cardsNum:0,trade_nas:0,helpInfo:!1}},mounted:function(){this.isMobile=this.$q.platform.is.mobile,this.isDesktop=this.$q.platform.is.desktop,this.isIOS=this.$q.platform.is.ios,this.isAndroid=this.$q.platform.is.android,this.blockchain=this.$store.state.blockchain.blockchain,this.contract=this.$store.state.blockchain.contract,this.address=this.$store.state.blockchain.address,!this.address&&this.isMobile&&(this.address=this.$q.localStorage.get.item("address"));var t=this.$q.localStorage.get.item("helpRead");t||(this.helpInfo=!0),this.loading=!0,setTimeout(this.getMeta,1e3)},computed:{tableData:function(){if(!this.meta.trades||0==this.meta.trades.length)return[];var t=[];for(var a in this.meta.trades)if(this.meta.trades[a]){var e=this.meta.trades[a],s={};s.winner=this.eatAddr(e.winner);var r=new Date(1e3*e.created);s.date=r.getMonth()+1+"/"+r.getDate()+" "+r.getHours()+":"+r.getMinutes(),s.nas=parseInt(e.NAS)/Math.pow(10,18),s.cardsNum=e.cardsNum,t.push(s)}return t}},methods:{readHelp:function(){this.helpInfo=!1,this.$q.localStorage.set("helpRead",!0)},checkWX:function(){var t=window.navigator.userAgent.toLowerCase();return"micromessenger"==t.match(/MicroMessenger/i)},eatAddr:function(t){if(t){var a="";return a=t.substr(0,4)+"...."+t.substr(-4,4),a}},getMeta:function(){var t=this,a=this.address;a||(a=t.blockchain.Account.NewAccount().getAddressString());var e="0",s="0",r="1000000",n="2000000",i="getMeta",o='["10"]',l={function:i,args:o},d=t.contract;t.loading=!0,t.meta={},t.cards=[],t.blockchain.neb.api.call(a,d,e,s,r,n,l).then(function(a){if(t.loading=!1,!a.result.startsWith("Error")&&JSON.parse(a.result)){t.meta=JSON.parse(a.result);var e=[];for(var s in t.meta.queue){var r=t.meta.queue[s];r.png=r.type+"-"+r.symbol,e.push(r)}t.cards=e}}).catch(function(a){t.loading=!1,console.log("error:"+a.message)})},newCard:function(){if(this.checkWX())this.$q.dialog({title:"微信浏览器受限",ok:!0,message:"请点击右上角菜单，选择在浏览器中打开"}).then(function(){}).catch(function(){});else{var t=this,a=this.address;a||(a=t.blockchain.Account.NewAccount().getAddressString());var e="0",s="0",r="1000000",n="2000000",i="getLastValue",o="",l={function:i,args:o},d=t.contract;t.loading=!0,t.blockchain.neb.api.call(a,d,e,s,r,n,l).then(function(a){console.log(a),t.loading=!1,a.result.startsWith("Error")||(t.lastValue=JSON.parse(a.result),t.lastValue||(t.lastValue=t.meta.minUnit),t.newCard_amount=t.lastValue,t.newCardDialog=!0)}).catch(function(a){t.loading=!1,console.log("error:"+a.message)})}},getACard:function(){var t=this,a={goods:{name:"example"},callback:"mainNet"==t.network?t.nebPay_mainnetUrl:t.nebPay_testnetUrl,listener:d},e=t.contract,s=parseFloat(t.newCard_amount),r=parseInt(t.lastValue),n=parseFloat(t.meta.maxUnit);if(s<r)t.$q.notify({type:"negative",message:"金额低于上一张牌("+r+")"});else if(s>n)t.$q.notify({type:"negative",message:"金额超出上限("+t.meta.maxUnit+")"});else{t.returned=!1,t.win=!1,t.returnedTrade={},t.returnedCard={},t.newCardDialog=!1;var i="getACard",o='["10"]';t.serialNumber=t.blockchain.nebPay.call(e,s,i,o,a);clearInterval(t.card_interval),t.card_interval=-1;var l=0;t.card_interval=setInterval(function(){if(l+=1,l>=40)return clearInterval(t.card_interval),void(t.card_interval=-1);t.blockchain.nebPay.queryPayInfo(t.serialNumber,{callback:"mainNet"==t.network?t.nebPay_mainnetUrl:t.nebPay_testnetUrl}).then(function(a){var e=JSON.parse(a);if(0==e.code){if(t.loading=!0,e.data.execute_result){t.loading=!1,console.log(e.data.execute_result);var s={};try{s=JSON.parse(e.data.execute_result)}catch(t){s={error:e.data.execute_result}}return s.error?(clearInterval(t.card_interval),t.card_interval=-1,t.$q.notify({type:"warning",message:s.errMsg,timeout:5e3}),void t.getMeta()):(t.loading=!1,clearInterval(t.card_interval),t.card_interval=-1,t.$store.commit("blockchain/setAddress",e.data.from),t.$q.localStorage.set("address",e.data.from),t.returned=!0,t.returnedCard=s.card,t.returnedCard.png=s.card.type+"-"+s.card.symbol,s.trade&&(t.returnedTrade=s.trade),t.win=s.win,t.win&&(t.trade_cardsNum=s.trade_cardsNum,t.trade_nas=parseInt(s.trade_nas)/Math.pow(10,18)),t.$q.notify({type:"positive",message:"出牌成功!",timeout:5e3,position:"bottom"}),void t.getMeta())}t.$q.notify({type:"positive",message:"正在写入区块链，请耐心等待!",timeout:1e3,position:"center"})}})},3500)}function d(a){if(!t.isMobile)return"[object String]"===Object.prototype.toString.call(a)&&a.startsWith("Error")?(t.loading=!1,void clearInterval(t.card_interval)):a.txhash?void 0:(t.loading=!1,void clearInterval(t.card_interval))}},openCardInfo:function(t){this.curCard=this.meta.queue[t];var a=this.meta.queue[t].playerAddress;this.curCard.shortAddr=a.substr(0,6)+"...."+a.substr(-6,6),this.curCard.dateStr=new Date(1e3*this.curCard.created).toLocaleString(),this.cardInfo=!0}}},i=n,o=(e("6YS0"),e("KHd+")),l=Object(o["a"])(i,s,r,!1,null,"6116d776",null);a["default"]=l.exports},kHkJ:function(t,a,e){},xXl9:function(t,a,e){t.exports=e.p+"img/default.7a119fb.png"}}]);